<div ng-controller="postsController" ng-init="loadNewsFeed()" infinite-scroll="loadNewsFeed()" infinite-scroll-disabled='busy' infinite-scroll-distance='0'>
    <div ng-repeat="post in posts">
        <!-- post container-->
        <div>
            <!-- author profile-->
            <div>
                <img ng-src="{{post.author.profileImageData || 'resources/defaultProfileImage.png'}}" class="lil-mid-thumbnail"/>
            </div>

            <!--<span class="author" popup-show="templates/user-preview.html" ng-click="loadUserDataPreview(post.author.username)">-->
                    <!--{{post.author.name}}-->
            <!--</span>-->

            <p>{{post.author.name}}</p>
            <p>{{post.date | date: "dd MMM yyyy HH:mm:ss"}}</p>

            <ul>
                <li ng-if="post.author.username === username" ng-click="post.editing = true; post.newPostContent = post.postContent">
                    <a>
                        edit
                    </a>
                </li>
                <li ng-if="post.author.username === username || isOwnWall">
                    <a ng-click="deletePost(post)">
                        delete
                    </a>
                </li>
            </ul>

            <div>
                <span ng-if="!post.editing">
                    {{post.postContent}}
                </span>
                <form ng-show="post.editing" name="editPostForm" ng-submit="editPost(post); post.editing = false">
                    <input type="text" ng-model="post.newPostContent" ng-minlength="1" required/>
                    <button type="submit" ng-disabled="editPostForm.$invalid">
                        Save
                    </button>
                    <a ng-click="post.editing = false">
                        Cancel
                    </a>
                </form>
            </div>

            <!-- post likes and comments-->
            <div>
                <span ng-if="isOwnWall || isOwnNewsFeed || post.author.isFriend || post.userFullData.isFriend">
                <span ng-if="!post.liked" ng-click="likePost(post)">
                    Like
                </span>
                <span ng-if="post.liked" ng-click="unlikePost(post)" >
                    Unlike
                </span>
                </span>
                <span>Post Likes: {{post.likesCount}}</span>
                <span>Post Comments: {{post.totalCommentsCount}}</span>
            </div>

            <!-- comment container-->
            <ul ng-controller="commentController">
                <li ng-repeat="comment in post.comments">
                    <img ng-src="{{comment.author.profileImageData || 'resources/defaultProfileImage.png'}}" class="lil-thumbnail"/>
                    <p>{{comment.author.name}}</p>
                    <p>{{comment.date | date: "dd MMM yyyy HH:mm:ss"}}</p>
                    <!-- comment content-->
                    <div>
                        <p>{{comment.commentContent}}</p>
                    </div>
                    <span>Comment likes: {{comment.likesCount}}</span>
                </li>
            </ul>

            <span>
                <div ng-include="'templates/comment.html'"></div>
            </span>

        </div>

        <li ng-if="post.totalCommentsCount > 0" ng-include="'templates/comments.html'"></li>

    </div>
</div>

<aside ng-controller="profileController" ng-init="loadOwnFriendsPreview()" ng-include="'templates/friends-preview.html'">
</aside>